<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - AEV</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Login Form */
        .login-container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            color: #4A90E2;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .login-header p {
            color: #666;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4A90E2 0%, #50C878 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #f5c6cb;
            display: none;
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 25px 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #4A90E2;
            font-size: 24px;
        }

        .header .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header .username {
            color: #666;
            font-size: 14px;
        }

        .btn-logout {
            padding: 8px 20px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: #c82333;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-header h2 {
            color: #333;
            font-size: 20px;
        }

        .icon {
            font-size: 24px;
        }

        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            min-height: 120px;
            resize: vertical;
            transition: all 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .file-upload {
            border: 2px dashed #4A90E2;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            background: #e9ecef;
            border-color: #357abd;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload-text {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }

        .preview-container {
            margin-top: 20px;
            text-align: center;
        }

        .preview-image {
            max-width: 200px;
            max-height: 200px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

.success-message {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    padding: 20px 30px;
    border-radius: 12px;
    margin-bottom: 20px;
    border-left: 6px solid #1e7e34;
    display: none;
    font-size: 18px;
    font-weight: 700;
    text-align: center;
    box-shadow: 0 8px 24px rgba(40, 167, 69, 0.5);
    animation: slideDown 0.4s ease;
    position: sticky;
    top: 0;
    z-index: 1000;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #4A90E2;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box p {
            color: #004085;
            font-size: 14px;
            line-height: 1.6;
        }

        .current-value {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 13px;
            color: #666;
            word-break: break-all;
        }

        .default-info {
            margin-top: 20px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 8px;
            text-align: center;
        }

        .default-info p {
            color: #856404;
            font-size: 13px;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .login-container, .card {
                padding: 20px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
        /* Toast Notification */
.toast-notification {
    position: fixed;
    top: 100px;
    right: 30px;
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    padding: 20px 30px;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(40, 167, 69, 0.4);
    z-index: 10000;
    display: none;
    animation: slideInRight 0.5s ease;
    font-size: 16px;
    font-weight: 600;
    min-width: 300px;
}

.toast-notification.show {
    display: block;
}

.toast-notification.error {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    box-shadow: 0 10px 30px rgba(220, 53, 69, 0.4);
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(100px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div class="login-container" id="loginForm">
            <div class="login-header">
                <h1>üîê Admin Panel</h1>
                <p>ƒêƒÉng nh·∫≠p ƒë·ªÉ qu·∫£n l√Ω h·ªá th·ªëng</p>
            </div>

            <div class="error-message" id="errorMessage"></div>

            <form id="loginFormElement">
                <div class="form-group">
                    <label>üë§ T√™n ƒëƒÉng nh·∫≠p</label>
                    <input type="text" id="username" placeholder="Nh·∫≠p username" required>
                </div>

                <div class="form-group">
                    <label>üîë M·∫≠t kh·∫©u</label>
                    <input type="password" id="password" placeholder="Nh·∫≠p password" required>
                </div>

                <button type="submit" class="btn btn-primary">ƒêƒÉng nh·∫≠p</button>
            </form>

            <div class="default-info">
                <p style="margin-bottom: 8px;">
                    <strong>üìù Th√¥ng tin ƒëƒÉng nh·∫≠p m·∫∑c ƒë·ªãnh:</strong>
                </p>
                <p>
                    Username: <strong>admin</strong> | Password: <strong>admin123</strong>
                </p>
            </div>
        </div>

        <!-- Admin Panel -->
        <div class="admin-panel" id="adminPanel">
            <div class="header">
                <h1>üéõÔ∏è B·∫£ng ƒêi·ªÅu Khi·ªÉn</h1>
                <div class="user-info">
                    <span class="username" id="displayUsername"></span>
                    <button class="btn-logout" onclick="handleLogout()">ƒêƒÉng xu·∫•t</button>
                </div>
            </div>

            <div class="success-message" id="successMessage"></div>

            <!-- Card 1: Google Form Link -->
            <div class="card">
                <div class="card-header">
                    <span class="icon">üìù</span>
                    <h2>Qu·∫£n l√Ω Link Google Form</h2>
                </div>

                <div class="info-box">
                    <p><strong>üí° H∆∞·ªõng d·∫´n:</strong> B·∫°n c√≥ th·ªÉ paste:</p>
                    <p style="margin-top: 8px;">
                        ‚úÖ <strong>Link tr·ª±c ti·∫øp:</strong> https://docs.google.com/forms/d/e/.../viewform<br>
                        ‚úÖ <strong>Code iframe:</strong> &lt;iframe src="..."&gt;&lt;/iframe&gt;
                    </p>
                    <p style="margin-top: 8px; font-size: 13px;">
                        H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông tr√≠ch xu·∫•t link v√† th√™m embedded=true
                    </p>
                </div>

                <div class="current-value" id="currentFormLink">
                    <strong>Link hi·ªán t·∫°i:</strong> <span id="currentLinkText">Ch∆∞a c√≥ d·ªØ li·ªáu</span>
                </div>

                <div class="form-group">
                    <label>üîó Link Google Form m·ªõi</label>
                    <textarea id="formLink" placeholder="Paste link Google Form embedded t·∫°i ƒë√¢y..."></textarea>
                </div>

                <button class="btn btn-primary" onclick="saveFormLink()">üíæ L∆∞u Link Form</button>
            </div>

            <!-- Card 2: Logo Management -->
            <div class="card">
                <div class="card-header">
                    <span class="icon">üñºÔ∏è</span>
                    <h2>Qu·∫£n l√Ω Logo</h2>
                </div>

                <div class="info-box">
                    <p><strong>üí° H∆∞·ªõng d·∫´n:</strong> Upload ·∫£nh logo m·ªõi (JPG, PNG, GIF). ·∫¢nh n√™n c√≥ k√≠ch th∆∞·ªõc vu√¥ng (v√≠ d·ª•: 500x500px) ƒë·ªÉ hi·ªÉn th·ªã t·ªët nh·∫•t.</p>
                </div>

                <div class="preview-container" id="currentLogoPreview">
                    <p style="color: #666; margin-bottom: 10px;"><strong>Logo hi·ªán t·∫°i:</strong></p>
                    <img id="currentLogo" class="preview-image" src="img/logo.jpg" alt="Current Logo" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%234A90E2%22 width=%22200%22 height=%22200%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2248%22 fill=%22white%22 text-anchor=%22middle%22 dy=%22.3em%22%3EAEV%3C/text%3E%3C/svg%3E'">
                </div>

                <div class="form-group" style="margin-top: 20px;">
                    <label class="file-upload" for="logoUpload">
                        <span class="icon">üì§</span>
                        <div class="file-upload-text">
                            <strong>Ch·ªçn ·∫£nh logo m·ªõi</strong><br>
                            <span style="font-size: 13px;">Click ƒë·ªÉ ch·ªçn file t·ª´ m√°y t√≠nh</span>
                        </div>
                        <input type="file" id="logoUpload" accept="image/*">
                    </label>
                </div>

                <div class="preview-container" id="newLogoPreview" style="display: none;">
                    <p style="color: #666; margin-bottom: 10px;"><strong>Preview ·∫£nh m·ªõi:</strong></p>
                    <img id="previewImage" class="preview-image" alt="Preview">
                </div>

                <button class="btn btn-primary" id="saveLogoBtn" onclick="saveLogo()" style="display: none; margin-top: 15px;">üíæ L∆∞u Logo M·ªõi</button>
            </div>
<!-- Card 3: Qu·∫£n l√Ω Sidebar -->
<div class="card">
    <div class="card-header">
        <span class="icon">üìù</span>
        <h2>Qu·∫£n l√Ω N·ªôi dung Sidebar</h2>
    </div>

    <div class="info-box">
        <p><strong>üí° H∆∞·ªõng d·∫´n:</strong> Ch·ªânh s·ª≠a n·ªôi dung 4 m·ª•c trong sidebar b√™n tr√°i (ch·ªâ hi·ªán tr√™n PC).</p>
    </div>

    <div class="form-group">
        <label>üìã Ti√™u ƒë·ªÅ H∆∞·ªõng d·∫´n</label>
        <input type="text" id="sidebarGuideTitle" placeholder="VD: üìã H∆∞·ªõng d·∫´n" value="üìã H∆∞·ªõng d·∫´n">
    </div>

    <div class="form-group">
        <label>üìã N·ªôi dung H∆∞·ªõng d·∫´n</label>
        <textarea id="sidebarGuideContent" placeholder="N·ªôi dung chi ti·∫øt...">Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin v√†o bi·ªÉu m·∫´u b√™n c·∫°nh. M·ªçi th√¥ng tin s·∫Ω ƒë∆∞·ª£c b·∫£o m·∫≠t.</textarea>
    </div>

    <div class="form-group">
        <label>‚è±Ô∏è Ti√™u ƒë·ªÅ Th·ªùi gian</label>
        <input type="text" id="sidebarTimeTitle" placeholder="VD: ‚è±Ô∏è Th·ªùi gian" value="‚è±Ô∏è Th·ªùi gian">
    </div>

    <div class="form-group">
        <label>‚è±Ô∏è N·ªôi dung Th·ªùi gian</label>
        <textarea id="sidebarTimeContent" placeholder="N·ªôi dung chi ti·∫øt...">Ho√†n th√†nh bi·ªÉu m·∫´u ch·ªâ m·∫•t kho·∫£ng 3-5 ph√∫t.</textarea>
    </div>

    <div class="form-group">
        <label>‚úâÔ∏è Ti√™u ƒë·ªÅ X√°c nh·∫≠n</label>
        <input type="text" id="sidebarConfirmTitle" placeholder="VD: ‚úâÔ∏è X√°c nh·∫≠n" value="‚úâÔ∏è X√°c nh·∫≠n">
    </div>

    <div class="form-group">
        <label>‚úâÔ∏è N·ªôi dung X√°c nh·∫≠n</label>
        <textarea id="sidebarConfirmContent" placeholder="N·ªôi dung chi ti·∫øt...">B·∫°n s·∫Ω nh·∫≠n email x√°c nh·∫≠n ngay sau khi g·ª≠i form th√†nh c√¥ng.</textarea>
    </div>

    <div class="form-group">
        <label>üí¨ Ti√™u ƒë·ªÅ H·ªó tr·ª£</label>
        <input type="text" id="sidebarSupportTitle" placeholder="VD: üí¨ C·∫ßn h·ªó tr·ª£?" value="üí¨ C·∫ßn h·ªó tr·ª£?">
    </div>

    <div class="form-group">
        <label>üí¨ N·ªôi dung H·ªó tr·ª£</label>
        <textarea id="sidebarSupportContent" placeholder="N·ªôi dung chi ti·∫øt...">Li√™n h·ªá v·ªõi ch√∫ng t√¥i qua Zalo n·∫øu g·∫∑p v·∫•n ƒë·ªÅ</textarea>
    </div>

    <button class="btn btn-primary" onclick="saveSidebarContent()">üíæ L∆∞u N·ªôi dung Sidebar</button>
</div>

<!-- Card 4: Qu·∫£n l√Ω S·ªë Zalo -->
<div class="card">
    <div class="card-header">
        <span class="icon">üì±</span>
        <h2>Qu·∫£n l√Ω S·ªë Zalo</h2>
    </div>

    <div class="info-box">
        <p><strong>üí° H∆∞·ªõng d·∫´n:</strong> Thay ƒë·ªïi s·ªë ƒëi·ªán tho·∫°i Zalo hi·ªÉn th·ªã trong popup li√™n h·ªá.</p>
    </div>

    <div class="current-value" id="currentZaloNumber">
        <strong>S·ªë hi·ªán t·∫°i:</strong> <span id="currentZaloText">0394304799</span>
    </div>

    <div class="form-group">
        <label>üì± S·ªë Zalo m·ªõi</label>
        <input type="tel" id="zaloNumber" placeholder="VD: 0394304799" pattern="[0-9]{10,11}" value="0394304799">
        <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
            Nh·∫≠p 10-11 s·ªë, kh√¥ng c√≥ kho·∫£ng tr·∫Øng ho·∫∑c k√Ω t·ª± ƒë·∫∑c bi·ªát
        </small>
    </div>

    <button class="btn btn-primary" onclick="saveZaloNumber()">üíæ L∆∞u S·ªë Zalo</button>
</div>
            <!-- Card 3: Export Code -->
            <div class="card">
                <div class="card-header">
                    <span class="icon">üì•</span>
                    <h2>Export Code</h2>
                </div>

                <div class="info-box">
                    <p><strong>üí° H∆∞·ªõng d·∫´n:</strong> Sau khi c·∫≠p nh·∫≠t xong, click n√∫t b√™n d∆∞·ªõi ƒë·ªÉ t·∫£i v·ªÅ file HTML ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t v·ªõi link form v√† logo m·ªõi.</p>
                </div>

                <button class="btn btn-secondary" onclick="exportUpdatedHTML()">üì• T·∫£i v·ªÅ HTML ƒë√£ c·∫≠p nh·∫≠t</button>
            </div>
        </div>
    </div>

    <script>
        let currentLogoBase64 = '';
        let isLoggedIn = false;

        // Mock storage cho m√¥i tr∆∞·ªùng local - d√πng localStorage ƒë·ªÉ share data
        if (typeof window.storage === 'undefined') {
            console.log('‚ö†Ô∏è S·ª≠ d·ª•ng localStorage ƒë·ªÉ l∆∞u tr·ªØ');
            window.storage = {
                get: function(key) {
                    try {
                        const value = localStorage.getItem(key);
                        return Promise.resolve(value ? { key: key, value: value } : null);
                    } catch (e) {
                        return Promise.resolve(null);
                    }
                },
                set: function(key, value) {
                    try {
                        localStorage.setItem(key, value);
                        console.log('üíæ ƒê√£ l∆∞u v√†o localStorage:', key);
                        return Promise.resolve({ key: key, value: value });
                    } catch (e) {
                        console.error('‚ùå L·ªói l∆∞u localStorage:', e);
                        return Promise.resolve(null);
                    }
                },
                delete: function(key) {
                    try {
                        localStorage.removeItem(key);
                        return Promise.resolve({ key: key, deleted: true });
                    } catch (e) {
                        return Promise.resolve(null);
                    }
                },
                list: function(prefix) {
                    try {
                        const keys = [];
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i);
                            if (!prefix || key.startsWith(prefix)) {
                                keys.push(key);
                            }
                        }
                        return Promise.resolve({ keys: keys });
                    } catch (e) {
                        return Promise.resolve({ keys: [] });
                    }
                }
            };
        }

        // Load data khi trang ƒë∆∞·ª£c t·∫£i
        window.addEventListener('load', function() {
            console.log('üîÑ Trang admin ƒë√£ load');
            loadSavedData();
        });

        // Load d·ªØ li·ªáu ƒë√£ l∆∞u
        async function loadSavedData() {
            try {
                console.log('üîç ƒêang load d·ªØ li·ªáu ƒë√£ l∆∞u...');
                
                // Load form link
                const formLinkData = await window.storage.get('aev_form_link');
                if (formLinkData && formLinkData.value) {
                    console.log('‚úÖ ƒê√£ load form link');
                    document.getElementById('currentLinkText').textContent = formLinkData.value;
                    document.getElementById('formLink').value = formLinkData.value;
                } else {
                    console.log('‚ÑπÔ∏è Ch∆∞a c√≥ form link ƒë√£ l∆∞u');
                }

                // Load logo
                const logoData = await window.storage.get('aev_logo_base64');
                if (logoData && logoData.value) {
                    console.log('‚úÖ ƒê√£ load logo');
                    currentLogoBase64 = logoData.value;
                    document.getElementById('currentLogo').src = logoData.value;
                } else {
                    console.log('‚ÑπÔ∏è Ch∆∞a c√≥ logo ƒë√£ l∆∞u');
                }
            } catch (error) {
                        await loadSidebarContent();
        await loadZaloNumber();
                console.warn('‚ö†Ô∏è L·ªói khi load d·ªØ li·ªáu:', error);
            }
        }

        // X·ª≠ l√Ω ƒëƒÉng nh·∫≠p
        document.getElementById('loginFormElement').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            console.log('üîê ƒêang ƒëƒÉng nh·∫≠p v·ªõi:', username);
            
            if (username === 'admin' && password === 'admin123') {
                isLoggedIn = true;
                console.log('‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!');
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('displayUsername').textContent = 'üë§ ' + username;
            } else {
                console.log('‚ùå Sai th√¥ng tin ƒëƒÉng nh·∫≠p');
                showError('‚ùå Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!');
            }
        });

        // ƒêƒÉng xu·∫•t
        function handleLogout() {
            isLoggedIn = false;
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Hi·ªÉn th·ªã l·ªói
// Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
function showSuccess(message) {
    // Hi·ªán th√¥ng b√°o trong card
    const successDiv = document.getElementById('successMessage');
    successDiv.textContent = message;
    successDiv.style.display = 'block';
    
    // T·∫°o toast notification
    showToast(message, 'success');
    
    setTimeout(function() {
        successDiv.style.display = 'none';
    }, 5000);
}

// Hi·ªÉn th·ªã l·ªói
function showError(message) {
    const errorDiv = document.getElementById('errorMessage');
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
    
    // T·∫°o toast notification
    showToast(message, 'error');
    
    setTimeout(function() {
        errorDiv.style.display = 'none';
    }, 5000);
}

// H√†m t·∫°o Toast Notification
function showToast(message, type) {
    // T·∫°o element toast
    const toast = document.createElement('div');
    toast.className = 'toast-notification';
    if (type === 'error') {
        toast.classList.add('error');
    }
    toast.textContent = message;
    
    // Th√™m v√†o body
    document.body.appendChild(toast);
    
    // Hi·ªán toast
    setTimeout(() => {
        toast.classList.add('show');
    }, 100);
    
    // ·∫®n sau 4 gi√¢y
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            document.body.removeChild(toast);
        }, 500);
    }, 4000);
}
        // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(function() {
                successDiv.style.display = 'none';
            }, 4000);
        }

        // L∆∞u Form Link
        async function saveFormLink() {
            let formLink = document.getElementById('formLink').value.trim();
            
            if (!formLink) {
                showError('‚ùå Vui l√≤ng nh·∫≠p link Google Form!');
                return;
            }

            // Tr√≠ch xu·∫•t link t·ª´ iframe code n·∫øu c·∫ßn
            if (formLink.includes('<iframe')) {
                console.log('üîç Ph√°t hi·ªán iframe code, ƒëang tr√≠ch xu·∫•t link...');
                const srcMatch = formLink.match(/src="([^"]+)"/);
                if (srcMatch && srcMatch[1]) {
                    formLink = srcMatch[1];
                    console.log('‚úÖ ƒê√£ tr√≠ch xu·∫•t link:', formLink);
                    // C·∫≠p nh·∫≠t textarea ƒë·ªÉ user th·∫•y link ƒë√£ tr√≠ch xu·∫•t
                    document.getElementById('formLink').value = formLink;
                } else {
                    showError('‚ùå Kh√¥ng t√¨m th·∫•y link trong iframe code!');
                    return;
                }
            }

            // Ki·ªÉm tra link h·ª£p l·ªá
            if (!formLink.includes('docs.google.com/forms')) {
                showError('‚ùå Link kh√¥ng h·ª£p l·ªá! Vui l√≤ng nh·∫≠p link Google Form.');
                return;
            }

            // ƒê·∫£m b·∫£o c√≥ embedded=true
            if (!formLink.includes('embedded=true')) {
                if (formLink.includes('?')) {
                    formLink += '&embedded=true';
                } else {
                    formLink += '?embedded=true';
                }
                console.log('‚úÖ ƒê√£ th√™m embedded=true:', formLink);
            }

            try {
                await window.storage.set('aev_form_link', formLink);
                document.getElementById('currentLinkText').textContent = formLink;
                showSuccess('‚úÖ ƒê√£ l∆∞u link Google Form th√†nh c√¥ng!');
            } catch (error) {
                showError('‚ùå L·ªói khi l∆∞u: ' + error.message);
            }
        }

        // X·ª≠ l√Ω upload logo
        document.getElementById('logoUpload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showError('‚ùå Vui l√≤ng ch·ªçn file ·∫£nh!');
                return;
            }

            const reader = new FileReader();
            
            reader.onload = function(e) {
                const base64 = e.target.result;
                currentLogoBase64 = base64;
                
                document.getElementById('previewImage').src = base64;
                document.getElementById('newLogoPreview').style.display = 'block';
                document.getElementById('saveLogoBtn').style.display = 'block';
            };
            
            reader.readAsDataURL(file);
        });

        // L∆∞u Logo
        async function saveLogo() {
            if (!currentLogoBase64) {
                showError('‚ùå Ch∆∞a c√≥ ·∫£nh ƒë·ªÉ l∆∞u!');
                return;
            }

            try {
                await window.storage.set('aev_logo_base64', currentLogoBase64);
                document.getElementById('currentLogo').src = currentLogoBase64;
                document.getElementById('newLogoPreview').style.display = 'none';
                document.getElementById('saveLogoBtn').style.display = 'none';
                showSuccess('‚úÖ ƒê√£ l∆∞u logo m·ªõi th√†nh c√¥ng!');
            } catch (error) {
                showError('‚ùå L·ªói khi l∆∞u: ' + error.message);
            }
        }

        // Export HTML ƒë√£ c·∫≠p nh·∫≠t
        async function exportUpdatedHTML() {
            try {
                const formLinkData = await window.storage.get('aev_form_link');
                const logoData = await window.storage.get('aev_logo_base64');

                const formLink = formLinkData ? formLinkData.value : 'LINK_FORM_MAC_DINH';
                const logoBase64 = logoData ? logoData.value : 'LOGO_MAC_DINH';

                alert('‚úÖ D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o Storage!\n\nForm Link: ' + (formLinkData ? 'C√≥' : 'Ch∆∞a c√≥') + '\nLogo: ' + (logoData ? 'C√≥' : 'Ch∆∞a c√≥') + '\n\nFile index.html s·∫Ω t·ª± ƒë·ªông load d·ªØ li·ªáu n√†y khi m·ªü.');
                
                showSuccess('‚úÖ D·ªØ li·ªáu ƒë√£ s·∫µn s√†ng! M·ªü l·∫°i index.html ƒë·ªÉ xem k·∫øt qu·∫£.');
            } catch (error) {
                showError('‚ùå L·ªói: ' + error.message);
            }
        }
        // Load Sidebar Content khi trang load
async function loadSidebarContent() {
    try {
        const sidebarData = await window.storage.get('aev_sidebar_content');
        if (sidebarData && sidebarData.value) {
            const content = JSON.parse(sidebarData.value);
            document.getElementById('sidebarGuideTitle').value = content.guideTitle || '';
            document.getElementById('sidebarGuideContent').value = content.guideContent || '';
            document.getElementById('sidebarTimeTitle').value = content.timeTitle || '';
            document.getElementById('sidebarTimeContent').value = content.timeContent || '';
            document.getElementById('sidebarConfirmTitle').value = content.confirmTitle || '';
            document.getElementById('sidebarConfirmContent').value = content.confirmContent || '';
            document.getElementById('sidebarSupportTitle').value = content.supportTitle || '';
            document.getElementById('sidebarSupportContent').value = content.supportContent || '';
        }
    } catch (error) {
        console.log('Ch∆∞a c√≥ d·ªØ li·ªáu sidebar');
    }
}

// L∆∞u Sidebar Content
async function saveSidebarContent() {
    const content = {
        guideTitle: document.getElementById('sidebarGuideTitle').value,
        guideContent: document.getElementById('sidebarGuideContent').value,
        timeTitle: document.getElementById('sidebarTimeTitle').value,
        timeContent: document.getElementById('sidebarTimeContent').value,
        confirmTitle: document.getElementById('sidebarConfirmTitle').value,
        confirmContent: document.getElementById('sidebarConfirmContent').value,
        supportTitle: document.getElementById('sidebarSupportTitle').value,
        supportContent: document.getElementById('sidebarSupportContent').value
    };

    try {
        await window.storage.set('aev_sidebar_content', JSON.stringify(content));
        showSuccess('‚úÖ ƒê√£ l∆∞u n·ªôi dung Sidebar th√†nh c√¥ng!');
    } catch (error) {
        showError('‚ùå L·ªói khi l∆∞u: ' + error.message);
    }
}

// Load S·ªë Zalo khi trang load
async function loadZaloNumber() {
    try {
        const zaloData = await window.storage.get('aev_zalo_number');
        if (zaloData && zaloData.value) {
            document.getElementById('currentZaloText').textContent = zaloData.value;
            document.getElementById('zaloNumber').value = zaloData.value;
        }
    } catch (error) {
        console.log('Ch∆∞a c√≥ s·ªë Zalo');
    }
}

// L∆∞u S·ªë Zalo
async function saveZaloNumber() {
    let zaloNumber = document.getElementById('zaloNumber').value.trim();
    
    // Validate s·ªë ƒëi·ªán tho·∫°i
    if (!zaloNumber) {
        showError('‚ùå Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i!');
        return;
    }
    
    // Lo·∫°i b·ªè kho·∫£ng tr·∫Øng v√† k√Ω t·ª± kh√¥ng ph·∫£i s·ªë
    zaloNumber = zaloNumber.replace(/\D/g, '');
    
    if (zaloNumber.length < 10 || zaloNumber.length > 11) {
        showError('‚ùå S·ªë ƒëi·ªán tho·∫°i ph·∫£i c√≥ 10-11 s·ªë!');
        return;
    }

    try {
        await window.storage.set('aev_zalo_number', zaloNumber);
        document.getElementById('currentZaloText').textContent = zaloNumber;
        showSuccess('‚úÖ ƒê√£ l∆∞u s·ªë Zalo th√†nh c√¥ng!');
    } catch (error) {
        showError('‚ùå L·ªói khi l∆∞u: ' + error.message);
    }
}
    </script>
</body>
</html>